<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>国別来場者入力</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Noto Sans JP', sans-serif; background: #f4f8fb; margin: 0; }
    header { background: #3b82f6; color: #fff; padding: 24px 0; font-size: 26px; font-weight: bold; text-align: center; }
    .container { display: flex; max-width: 1100px; margin: 30px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(59,130,246,0.08); min-height: 700px; }
    .left-list {
      width: 320px;
      border-right: 1px solid #e5e7eb;
      padding: 32px 18px 32px 18px;
      display: flex;
      flex-direction: column;
      background: #f8fafc;
    }
    .left-list-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 18px;
      color: #2563eb;
    }
    .input-items {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 18px;
    }
    .input-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }
    .input-item:last-child { border-bottom: none; }
    .input-item-country {
      font-size: 16px;
      font-weight: bold;
      color: #1e293b;
      margin-left: 0;
    }
    .input-item-qty {
      font-size: 15px;
      color: #64748b;
      margin-left: 8px;
    }
    .input-total {
      font-size: 18px;
      font-weight: bold;
      color: #1e293b;
      text-align: right;
      margin-top: 18px;
      margin-bottom: 12px;
    }
    .main-area {
      flex: 1;
      padding: 32px 32px 32px 32px;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .country-header {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 18px;
      color: #2563eb;
    }
    .input-row { margin: 0 0 18px 0; }
    .input-row label { font-size: 16px; }
    .country-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 14px;
      margin-bottom: 40px;
    }
    .country-btn {
      background: #e0e7ff;
      border: none;
      border-radius: 0; /* 角丸なしで角ばった四角 */
      font-size: 18px;
      font-weight: 600;
      padding: 0;
      color: #2563eb;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      box-shadow: 0 2px 8px rgba(59,130,246,0.07);
      width: 100%;
      height: 70px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      outline: none;
    }
    .country-btn.selected {
      background: #3b82f6;
      color: #fff;
      border: 2.5px solid #2563eb;
    }
    .country-flag-bg {
      font-size: 28px;
      margin-bottom: 2px;
    }
    .country-btn .count {
      position: absolute;
      top: 8px;
      right: 14px;
      background: #2563eb;
      color: #fff;
      font-size: 15px;
      border-radius: 10px;
      padding: 2px 10px;
      font-weight: bold;
    }
    .action-area {
      display: flex;
      justify-content: flex-end;
      gap: 18px;
      margin: 32px 0 0 0;
    }
    .square-btn {
      width: 180px;
      padding: 18px 0;
      border-radius: 0;
      border: none;
      background: #e0e7ff;
      color: #2563eb;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 0;
      box-shadow: 0 2px 8px rgba(59,130,246,0.07);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
      text-align: center;
    }
    .square-btn.main {
      background: #3b82f6;
      color: #fff;
      border: 2px solid #2563eb;
    }
    .square-btn:hover {
      background: #bae6fd;
    }
    .msg { color: #2563eb; margin-left: 10px; }
    @media (max-width: 900px) {
      .container { flex-direction: column; }
      .left-list { width: 100%; border-right: none; border-bottom: 1px solid #e5e7eb; }
      .main-area { padding: 18px; }
      .action-area { flex-direction: column; align-items: stretch; }
      .country-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <header>国別来場者入力</header>
  <div class="container">
    <!-- 左側：入力リスト -->
    <div class="left-list">
      <div>
        <div class="left-list-header">入力リスト</div>
        <div class="input-items" id="inputItems"></div>
        <div class="input-total" id="inputTotal">合計 0件</div>
      </div>
    </div>
    <!-- 右側：国パネル -->
    <div class="main-area">
      <div class="country-header">国別来場者入力</div>
      <div class="input-row">
        <label>日付: <input type="date" id="date-input"></label>
      </div>
      <div class="country-grid" id="countryGrid"></div>
      <div class="action-area">
        <button class="square-btn" onclick="clearPanel()">クリア</button>
        <button class="square-btn main" onclick="submitData()">送信</button>
        <span id="msg" class="msg"></span>
      </div>
    </div>
  </div>
  <script>
const firebaseConfig = {
  apiKey: "AIzaSyDSZohtnPXem6m7f6A63KjXTQMUUFNk0Cg",
  authDomain: "ghost-entrance.firebaseapp.com",
  databaseURL: "https://ghost-entrance-default-rtdb.firebaseio.com",
  projectId: "ghost-entrance",
  storageBucket: "ghost-entrance.firebasestorage.app",
  messagingSenderId: "977704976997",
  appId: "1:977704976997:web:e61ef8bdc61babc2757c8c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const countryList = [
  {region:"アジア", flag:"🇰🇷", jp:"韓国", en:"South Korea"},
  {region:"アジア", flag:"🇨🇳", jp:"中国", en:"China"},
  {region:"アジア", flag:"🇹🇼", jp:"台湾", en:"Taiwan"},
  {region:"アジア", flag:"🇭🇰", jp:"香港", en:"Hong Kong"},
  {region:"アジア", flag:"🇹🇭", jp:"タイ", en:"Thailand"},
  {region:"アジア", flag:"🇻🇳", jp:"ベトナム", en:"Vietnam"},
  {region:"アジア", flag:"🇵🇭", jp:"フィリピン", en:"Philippines"},
  {region:"アジア", flag:"🇮🇩", jp:"インドネシア", en:"Indonesia"},
  {region:"アジア", flag:"🇲🇾", jp:"マレーシア", en:"Malaysia"},
  {region:"アジア", flag:"🇸🇬", jp:"シンガポール", en:"Singapore"},
  {region:"アジア", flag:"🇮🇳", jp:"インド", en:"India"},
  {region:"アジア", flag:"🇵🇰", jp:"パキスタン", en:"Pakistan"},
  {region:"アジア", flag:"🇳🇵", jp:"ネパール", en:"Nepal"},
  {region:"アジア", flag:"🇱🇰", jp:"スリランカ", en:"Sri Lanka"},
  {region:"アジア", flag:"🇲🇳", jp:"モンゴル", en:"Mongolia"},
  {region:"アジア", flag:"🇧🇩", jp:"バングラデシュ", en:"Bangladesh"},
  {region:"アジア", flag:"🇰🇭", jp:"カンボジア", en:"Cambodia"},
  {region:"アジア", flag:"🇱🇦", jp:"ラオス", en:"Laos"},
  {region:"アジア", flag:"🇧🇳", jp:"ブルネイ", en:"Brunei"},
  {region:"アジア", flag:"🇹🇱", jp:"東ティモール", en:"Timor-Leste"},
  {region:"欧州", flag:"🇬🇧", jp:"イギリス", en:"United Kingdom"},
  {region:"欧州", flag:"🇫🇷", jp:"フランス", en:"France"},
  {region:"欧州", flag:"🇩🇪", jp:"ドイツ", en:"Germany"},
  {region:"欧州", flag:"🇮🇹", jp:"イタリア", en:"Italy"},
  {region:"欧州", flag:"🇪🇸", jp:"スペイン", en:"Spain"},
  {region:"欧州", flag:"🇳🇱", jp:"オランダ", en:"Netherlands"},
  {region:"欧州", flag:"🇨🇭", jp:"スイス", en:"Switzerland"},
  {region:"欧州", flag:"🇸🇪", jp:"スウェーデン", en:"Sweden"},
  {region:"欧州", flag:"🇳🇴", jp:"ノルウェー", en:"Norway"},
  {region:"欧州", flag:"🇫🇮", jp:"フィンランド", en:"Finland"},
  {region:"欧州", flag:"🇩🇰", jp:"デンマーク", en:"Denmark"},
  {region:"欧州", flag:"🇦🇹", jp:"オーストリア", en:"Austria"},
  {region:"欧州", flag:"🇵🇱", jp:"ポーランド", en:"Poland"},
  {region:"欧州", flag:"🇨🇿", jp:"チェコ", en:"Czech Republic"},
  {region:"欧州", flag:"🇧🇪", jp:"ベルギー", en:"Belgium"},
  {region:"北米", flag:"🇺🇸", jp:"アメリカ", en:"United States"},
  {region:"北米", flag:"🇨🇦", jp:"カナダ", en:"Canada"},
  {region:"中南米", flag:"🇲🇽", jp:"メキシコ", en:"Mexico"},
  {region:"中南米", flag:"🇧🇷", jp:"ブラジル", en:"Brazil"},
  {region:"中南米", flag:"🇦🇷", jp:"アルゼンチン", en:"Argentina"},
  {region:"中南米", flag:"🇨🇱", jp:"チリ", en:"Chile"},
  {region:"中南米", flag:"🇵🇪", jp:"ペルー", en:"Peru"},
  {region:"中南米", flag:"🇨🇴", jp:"コロンビア", en:"Colombia"},
  {region:"オセアニア", flag:"🇦🇺", jp:"オーストラリア", en:"Australia"},
  {region:"オセアニア", flag:"🇳🇿", jp:"ニュージーランド", en:"New Zealand"},
  {region:"中東・アフリカ", flag:"🇹🇷", jp:"トルコ", en:"Turkey"},
  {region:"中東・アフリカ", flag:"🇸🇦", jp:"サウジアラビア", en:"Saudi Arabia"},
  {region:"中東・アフリカ", flag:"🇦🇪", jp:"アラブ首長国連邦", en:"United Arab Emirates"},
  {region:"中東・アフリカ", flag:"🇿🇦", jp:"南アフリカ", en:"South Africa"},
  {region:"中東・アフリカ", flag:"🇪🇬", jp:"エジプト", en:"Egypt"}
];

// 表示したい国のcountryList内インデックスを指定
const panelCountryIndexes = [
  35, // アメリカ
  1,  // 中国
  0,  // 韓国
  21, // フランス
  20, // イギリス
  43, // オーストラリア
  36, // カナダ
  4,  // タイ
  25, // オランダ
  23, // イタリア
  22, // ドイツ
  10, // インド
  27, // スウェーデン
  45, // トルコ
  6,  // フィリピン
  8,  // マレーシア
  44, // ニュージーランド
  37, // メキシコ
  46, // サウジアラビア
  47, // アラブ首長国連邦
  26, // スイス
  28, // ノルウェー
  9,  // シンガポール
  3,  // 香港
  2   // 台湾
];

const topCountryList = panelCountryIndexes.map(idx => countryList[idx]);
let panelCounts = Array(topCountryList.length).fill(0);
let inputList = [];

// 日付デフォルト自動入力（7時までは前日、それ以降は当日）
function setDefaultDate() {
  const now = new Date();
  let dateObj = new Date(now);
  if (now.getHours() < 7) {
    dateObj.setDate(now.getDate() - 1);
  }
  const yyyy = dateObj.getFullYear();
  const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
  const dd = String(dateObj.getDate()).padStart(2, '0');
  document.getElementById('date-input').value = `${yyyy}-${mm}-${dd}`;
}

// 国パネル生成（角ばった四角・複数回押し対応）
function renderCountryPanel() {
  const panel = document.getElementById('countryGrid');
  panel.innerHTML = '';
  topCountryList.forEach((c, idx) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'country-btn' + (panelCounts[idx] ? ' selected' : '');
    btn.innerHTML = `
      <span class="country-flag-bg">${c.flag}</span>
      <span>${c.jp}</span>
      ${panelCounts[idx] ? `<span class="count">×${panelCounts[idx]}</span>` : ''}
    `;
    btn.onclick = () => {
      panelCounts[idx]++;
      // 左リストに追加
      const existIdx = inputList.findIndex(item => item.idx === idx);
      if (existIdx >= 0) {
        inputList[existIdx].qty++;
      } else {
        inputList.push({ idx, qty: 1 });
      }
      renderCountryPanel();
      renderInputList();
    };
    panel.appendChild(btn);
  });
}

// 左側リスト描画
function renderInputList() {
  const area = document.getElementById('inputItems');
  area.innerHTML = '';
  inputList.forEach((item, i) => {
    const c = topCountryList[item.idx];
    area.innerHTML += `
      <div class="input-item">
        <span>
          <span class="input-item-country">${c.flag} ${c.jp}</span>
          <span class="input-item-qty">×${item.qty}</span>
        </span>
        <button onclick="removeInput(${i})" style="background:#f87171;color:#fff;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;">削除</button>
      </div>
    `;
  });
  document.getElementById('inputTotal').textContent = `合計 ${inputList.reduce((a, b) => a + b.qty, 0)}件`;
}

// 入力削除
function removeInput(i) {
  const idx = inputList[i].idx;
  panelCounts[idx] = 0;
  inputList.splice(i, 1);
  renderCountryPanel();
  renderInputList();
}

// クリア
function clearPanel() {
  panelCounts = Array(topCountryList.length).fill(0);
  inputList = [];
  renderCountryPanel();
  renderInputList();
  document.getElementById('msg').textContent = '';
}

// 送信
function submitData() {
  const date = document.getElementById('date-input').value;
  if (!date) {
    document.getElementById('msg').textContent = '日付を入力してください';
    return;
  }
  if (inputList.length === 0) {
    document.getElementById('msg').textContent = '国を選択してください';
    return;
  }
  inputList.forEach(item => {
    const time = getNowTimeStr();
    db.ref('country').push({
      date,
      countryIdx: panelCountryIndexes[item.idx], // countryListのインデックスを保存
      count: item.qty,
      time
    });
  });
  clearPanel();
  document.getElementById('msg').textContent = '送信しました';
}

// 現在時刻（hh:mm）取得
function getNowTimeStr() {
  const d = new Date();
  return `${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
}

// 初期表示
window.addEventListener('DOMContentLoaded', () => {
  setDefaultDate();
  renderCountryPanel();
  renderInputList();
});
  </script>
</body>
</html>