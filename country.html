<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å›½åˆ¥æ¥å ´è€…è¨˜éŒ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Noto Sans JP', sans-serif; background: #f4f8fb; margin: 0; }
    header { background: #3b82f6; color: #fff; padding: 24px 0; font-size: 26px; font-weight: bold; text-align: center; }
    main { max-width: 800px; margin: 30px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(59,130,246,0.08); padding: 30px 20px; }
    h2 { color: #2563eb; margin-top: 30px; }
    .input-row { margin: 24px 0 18px 0; display: flex; gap: 24px; align-items: center; }
    .input-row label { font-size: 16px; }
    #country-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
      justify-content: center;
    }
    .country-btn {
      width: 160px;
      height: 80px;
      font-size: 20px;
      font-weight: bold;
      border-radius: 16px;
      margin-bottom: 8px;
      border: none;
      box-shadow: 0 2px 8px rgba(59,130,246,0.10);
      background: linear-gradient(135deg, #e0e7ff 60%, #fff 100%);
      position: relative;
      transition: 0.15s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .country-btn.selected {
      background: linear-gradient(135deg, #60a5fa 60%, #fff 100%);
      color: #fff;
      border: 2.5px solid #2563eb;
    }
    .country-flag-bg {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 8px rgba(59,130,246,0.10);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      margin-bottom: 4px;
    }
    .country-btn .count {
      position: absolute;
      top: 8px;
      right: 14px;
      background: #2563eb;
      color: #fff;
      font-size: 15px;
      border-radius: 10px;
      padding: 2px 10px;
      font-weight: bold;
    }
    #confirm-btn {
      font-size: 22px;
      padding: 16px 40px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 14px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(59,130,246,0.10);
      cursor: pointer;
      margin-top: 10px;
      margin-bottom: 10px;
      transition: 0.1s;
    }
    #confirm-btn:hover {
      background: #1d4ed8;
    }
    .stat-table { width: 100%; border-collapse: collapse; margin: 18px 0 30px 0; }
    .stat-table th, .stat-table td { border: 1px solid #ccc; padding: 8px 10px; text-align: center; }
    .stat-table th { background: #e0e7ff; }
    .highlight { background: #fef9c3; }
    .desc { color: #64748b; font-size: 15px; margin-bottom: 18px; }
    .msg { color: #2563eb; margin-left: 10px; }
    @media (max-width: 700px) {
      main { padding: 10px 2vw; }
      .input-row { flex-direction: column; gap: 10px; }
      #country-panel { gap: 8px; }
      .country-btn { width: 100%; height: 60px; font-size: 17px; }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <link rel="apple-touch-icon" href="country-thumb.png">
  <link rel="icon" type="image/png" sizes="192x192" href="country-thumb.png">
  <link rel="manifest" href="manifest-country.json">
</head>
<body>
  <header>å›½åˆ¥æ¥å ´è€…è¨˜éŒ²</header>
  <main>
    <div class="desc">
      å„å›½ã®æ¥å ´è€…æ•°ã‚’ãƒ‘ãƒãƒ«ã§é¸æŠã—ã¦è¨˜éŒ²ã§ãã¾ã™ã€‚<br>
      æ—¥ä»˜ã‚’å…¥åŠ›ã—ã€å›½ãƒ‘ãƒãƒ«ã‚’äººæ•°åˆ†æŠ¼ã—ã¦ã€Œç¢ºå®šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
    </div>
    <div class="input-row">
      <label>æ—¥ä»˜: <input type="date" id="date-input"></label>
    </div>
    <div id="country-panel"></div>
    <div style="margin-bottom:24px; text-align:center;">
      <button id="confirm-btn" onclick="confirmPanel()">ç¢ºå®š</button>
      <span id="msg" class="msg"></span>
    </div>
    <h2>æœ¬æ—¥ã®è¨˜éŒ²</h2>
    <table class="stat-table">
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>æ™‚é–“</th>
          <th>å›½</th>
          <th>äººæ•°</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="country-table-body"></tbody>
    </table>
  </main>
  <script>
const firebaseConfig = {
  apiKey: "AIzaSyDSZohtnPXem6m7f6A63KjXTQMUUFNk0Cg",
  authDomain: "ghost-entrance.firebaseapp.com",
  databaseURL: "https://ghost-entrance-default-rtdb.firebaseio.com",
  projectId: "ghost-entrance",
  storageBucket: "ghost-entrance.firebasestorage.app",
  messagingSenderId: "977704976997",
  appId: "1:977704976997:web:e61ef8bdc61babc2757c8c"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const countryList = [
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡°ğŸ‡·", jp:"éŸ“å›½", en:"South Korea"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡¨ğŸ‡³", jp:"ä¸­å›½", en:"China"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡¹ğŸ‡¼", jp:"å°æ¹¾", en:"Taiwan"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡­ğŸ‡°", jp:"é¦™æ¸¯", en:"Hong Kong"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡¹ğŸ‡­", jp:"ã‚¿ã‚¤", en:"Thailand"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡»ğŸ‡³", jp:"ãƒ™ãƒˆãƒŠãƒ ", en:"Vietnam"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡µğŸ‡­", jp:"ãƒ•ã‚£ãƒªãƒ”ãƒ³", en:"Philippines"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡®ğŸ‡©", jp:"ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢", en:"Indonesia"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡²ğŸ‡¾", jp:"ãƒãƒ¬ãƒ¼ã‚·ã‚¢", en:"Malaysia"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡¸ğŸ‡¬", jp:"ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«", en:"Singapore"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡®ğŸ‡³", jp:"ã‚¤ãƒ³ãƒ‰", en:"India"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡µğŸ‡°", jp:"ãƒ‘ã‚­ã‚¹ã‚¿ãƒ³", en:"Pakistan"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡³ğŸ‡µ", jp:"ãƒãƒ‘ãƒ¼ãƒ«", en:"Nepal"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡±ğŸ‡°", jp:"ã‚¹ãƒªãƒ©ãƒ³ã‚«", en:"Sri Lanka"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡²ğŸ‡³", jp:"ãƒ¢ãƒ³ã‚´ãƒ«", en:"Mongolia"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡§ğŸ‡©", jp:"ãƒãƒ³ã‚°ãƒ©ãƒ‡ã‚·ãƒ¥", en:"Bangladesh"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡°ğŸ‡­", jp:"ã‚«ãƒ³ãƒœã‚¸ã‚¢", en:"Cambodia"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡±ğŸ‡¦", jp:"ãƒ©ã‚ªã‚¹", en:"Laos"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡§ğŸ‡³", jp:"ãƒ–ãƒ«ãƒã‚¤", en:"Brunei"},
  {region:"ã‚¢ã‚¸ã‚¢", flag:"ğŸ‡¹ğŸ‡±", jp:"æ±ãƒ†ã‚£ãƒ¢ãƒ¼ãƒ«", en:"Timor-Leste"},
  {region:"æ¬§å·", flag:"ğŸ‡¬ğŸ‡§", jp:"ã‚¤ã‚®ãƒªã‚¹", en:"United Kingdom"},
  {region:"æ¬§å·", flag:"ğŸ‡«ğŸ‡·", jp:"ãƒ•ãƒ©ãƒ³ã‚¹", en:"France"},
  {region:"æ¬§å·", flag:"ğŸ‡©ğŸ‡ª", jp:"ãƒ‰ã‚¤ãƒ„", en:"Germany"},
  {region:"æ¬§å·", flag:"ğŸ‡®ğŸ‡¹", jp:"ã‚¤ã‚¿ãƒªã‚¢", en:"Italy"},
  {region:"æ¬§å·", flag:"ğŸ‡ªğŸ‡¸", jp:"ã‚¹ãƒšã‚¤ãƒ³", en:"Spain"},
  {region:"æ¬§å·", flag:"ğŸ‡³ğŸ‡±", jp:"ã‚ªãƒ©ãƒ³ãƒ€", en:"Netherlands"},
  {region:"æ¬§å·", flag:"ğŸ‡¨ğŸ‡­", jp:"ã‚¹ã‚¤ã‚¹", en:"Switzerland"},
  {region:"æ¬§å·", flag:"ğŸ‡¸ğŸ‡ª", jp:"ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³", en:"Sweden"},
  {region:"æ¬§å·", flag:"ğŸ‡³ğŸ‡´", jp:"ãƒãƒ«ã‚¦ã‚§ãƒ¼", en:"Norway"},
  {region:"æ¬§å·", flag:"ğŸ‡«ğŸ‡®", jp:"ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰", en:"Finland"},
  {region:"æ¬§å·", flag:"ğŸ‡©ğŸ‡°", jp:"ãƒ‡ãƒ³ãƒãƒ¼ã‚¯", en:"Denmark"},
  {region:"æ¬§å·", flag:"ğŸ‡¦ğŸ‡¹", jp:"ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢", en:"Austria"},
  {region:"æ¬§å·", flag:"ğŸ‡µğŸ‡±", jp:"ãƒãƒ¼ãƒ©ãƒ³ãƒ‰", en:"Poland"},
  {region:"æ¬§å·", flag:"ğŸ‡¨ğŸ‡¿", jp:"ãƒã‚§ã‚³", en:"Czech Republic"},
  {region:"æ¬§å·", flag:"ğŸ‡§ğŸ‡ª", jp:"ãƒ™ãƒ«ã‚®ãƒ¼", en:"Belgium"},
  {region:"åŒ—ç±³", flag:"ğŸ‡ºğŸ‡¸", jp:"ã‚¢ãƒ¡ãƒªã‚«", en:"United States"},
  {region:"åŒ—ç±³", flag:"ğŸ‡¨ğŸ‡¦", jp:"ã‚«ãƒŠãƒ€", en:"Canada"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡²ğŸ‡½", jp:"ãƒ¡ã‚­ã‚·ã‚³", en:"Mexico"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡§ğŸ‡·", jp:"ãƒ–ãƒ©ã‚¸ãƒ«", en:"Brazil"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡¦ğŸ‡·", jp:"ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³", en:"Argentina"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡¨ğŸ‡±", jp:"ãƒãƒª", en:"Chile"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡µğŸ‡ª", jp:"ãƒšãƒ«ãƒ¼", en:"Peru"},
  {region:"ä¸­å—ç±³", flag:"ğŸ‡¨ğŸ‡´", jp:"ã‚³ãƒ­ãƒ³ãƒ“ã‚¢", en:"Colombia"},
  {region:"ã‚ªã‚»ã‚¢ãƒ‹ã‚¢", flag:"ğŸ‡¦ğŸ‡º", jp:"ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢", en:"Australia"},
  {region:"ã‚ªã‚»ã‚¢ãƒ‹ã‚¢", flag:"ğŸ‡³ğŸ‡¿", jp:"ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰", en:"New Zealand"},
  {region:"ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚«", flag:"ğŸ‡¹ğŸ‡·", jp:"ãƒˆãƒ«ã‚³", en:"Turkey"},
  {region:"ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚«", flag:"ğŸ‡¸ğŸ‡¦", jp:"ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢", en:"Saudi Arabia"},
  {region:"ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚«", flag:"ğŸ‡¦ğŸ‡ª", jp:"ã‚¢ãƒ©ãƒ–é¦–é•·å›½é€£é‚¦", en:"United Arab Emirates"},
  {region:"ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚«", flag:"ğŸ‡¿ğŸ‡¦", jp:"å—ã‚¢ãƒ•ãƒªã‚«", en:"South Africa"},
  {region:"ä¸­æ±ãƒ»ã‚¢ãƒ•ãƒªã‚«", flag:"ğŸ‡ªğŸ‡¬", jp:"ã‚¨ã‚¸ãƒ—ãƒˆ", en:"Egypt"}
];

// è¡¨ç¤ºã—ãŸã„å›½ã®countryListå†…ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æŒ‡å®š
const panelCountryIndexes = [
  35, // ã‚¢ãƒ¡ãƒªã‚«
  1,  // ä¸­å›½
  0,  // éŸ“å›½
  21, // ãƒ•ãƒ©ãƒ³ã‚¹
  20, // ã‚¤ã‚®ãƒªã‚¹
  43, // ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢
  36, // ã‚«ãƒŠãƒ€
  4,  // ã‚¿ã‚¤
  25, // ã‚ªãƒ©ãƒ³ãƒ€
  23, // ã‚¤ã‚¿ãƒªã‚¢
  22, // ãƒ‰ã‚¤ãƒ„
  10, // ã‚¤ãƒ³ãƒ‰
  27, // ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³
  45, // ãƒˆãƒ«ã‚³
  6,  // ãƒ•ã‚£ãƒªãƒ”ãƒ³
  8,  // ãƒãƒ¬ãƒ¼ã‚·ã‚¢
  44, // ãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰
  37, // ãƒ¡ã‚­ã‚·ã‚³
  46, // ã‚µã‚¦ã‚¸ã‚¢ãƒ©ãƒ“ã‚¢
  47, // ã‚¢ãƒ©ãƒ–é¦–é•·å›½é€£é‚¦
  26, // ã‚¹ã‚¤ã‚¹
  28, // ãƒãƒ«ã‚¦ã‚§ãƒ¼
  9,  // ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«
  3,  // é¦™æ¸¯
  2   // å°æ¹¾
];

const topCountryList = panelCountryIndexes.map(idx => countryList[idx]);
let panelCounts = Array(topCountryList.length).fill(0);
let countryData = [];

// æ—¥ä»˜ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‡ªå‹•å…¥åŠ›ï¼ˆ7æ™‚ã¾ã§ã¯å‰æ—¥ã€ãã‚Œä»¥é™ã¯å½“æ—¥ï¼‰
function setDefaultDate() {
  const now = new Date();
  let dateObj = new Date(now);
  if (now.getHours() < 7) {
    dateObj.setDate(now.getDate() - 1);
  }
  const yyyy = dateObj.getFullYear();
  const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
  const dd = String(dateObj.getDate()).padStart(2, '0');
  document.getElementById('date-input').value = `${yyyy}-${mm}-${dd}`;
}

// å›½ãƒ‘ãƒãƒ«ç”Ÿæˆï¼ˆå‡ç­‰ãªé•·æ–¹å½¢ãƒ»è¤‡æ•°å›æŠ¼ã—å¯¾å¿œãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³å¼·åŒ–ï¼‰
function renderCountryPanel() {
  const panel = document.getElementById('country-panel');
  panel.innerHTML = '';
  topCountryList.forEach((c, idx) => {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'country-btn' + (panelCounts[idx] ? ' selected' : '');
    btn.innerHTML = `
      <span class="country-flag-bg">${c.flag}</span>
      <span>${c.jp}</span>
      ${panelCounts[idx] ? `<span class="count">Ã—${panelCounts[idx]}</span>` : ''}
    `;
    btn.onclick = () => {
      panelCounts[idx]++;
      renderCountryPanel();
    };
    panel.appendChild(btn);
  });
}

// ç¾åœ¨æ™‚åˆ»ï¼ˆhh:mmï¼‰å–å¾—
function getNowTimeStr() {
  const d = new Date();
  return `${d.getHours().toString().padStart(2, '0')}:${d.getMinutes().toString().padStart(2, '0')}`;
}

// ç¢ºå®šãƒœã‚¿ãƒ³ã§ã¾ã¨ã‚ã¦ç™»éŒ²
function confirmPanel() {
  const date = document.getElementById('date-input').value;
  if (!date) {
    document.getElementById('msg').textContent = 'æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
    return;
  }
  let any = false;
  panelCounts.forEach((count, idx) => {
    if (count > 0) {
      any = true;
      const time = getNowTimeStr();
      db.ref('country').push({
        date,
        countryIdx: panelCountryIndexes[idx], // countryListã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿å­˜
        count,
        time
      });
    }
  });
  if (!any) {
    document.getElementById('msg').textContent = 'å›½ã‚’é¸æŠã—ã¦ãã ã•ã„';
    return;
  }
  panelCounts = Array(topCountryList.length).fill(0);
  renderCountryPanel();
  document.getElementById('msg').textContent = 'è¨˜éŒ²ã—ã¾ã—ãŸ';
  loadCountryData();
}

// ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
function loadCountryData() {
  db.ref('country').get().then(snapshot => {
    if (!snapshot.exists()) return;
    countryData = [];
    const obj = snapshot.val();
    Object.keys(obj).forEach(key => {
      countryData.push({ ...obj[key], key });
    });
    renderTable();
  });
}

// ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
function renderTable() {
  const tbody = document.getElementById('country-table-body');
  tbody.innerHTML = '';
  const selectedDate = document.getElementById('date-input').value;
  const filtered = countryData
    .map((row, idx) => ({ ...row, _originalIdx: idx }))
    .filter(row => row.date === selectedDate)
    .reverse();

  filtered.forEach((row) => {
    const c = countryList[row.countryIdx];
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row.date}</td>
      <td>${row.time || ''}</td>
      <td>${c ? `${c.flag} ${c.jp} (${c.en})` : 'ä¸æ˜'}</td>
      <td>${row.count}</td>
      <td>
        <button onclick="deleteRow(${row._originalIdx})">å‰Šé™¤</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// å‰Šé™¤
function deleteRow(idx) {
  const key = countryData[idx].key;
  if (!key) return;
  db.ref('country/' + key).remove().then(() => {
    loadCountryData();
  });
}

// æ—¥ä»˜å¤‰æ›´æ™‚ã«ãƒ†ãƒ¼ãƒ–ãƒ«å†æç”»
document.getElementById('date-input').addEventListener('change', renderTable);

// åˆæœŸè¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã‚»ãƒƒãƒˆãƒ»ãƒ‘ãƒãƒ«æç”»ãƒ»ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼‰
window.addEventListener('DOMContentLoaded', () => {
  setDefaultDate();
  renderCountryPanel();
  loadCountryData();
});
  </script>
</body>
</html>